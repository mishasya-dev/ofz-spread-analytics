# OFZ Spread Analytics - –ñ—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç—ã

## v0.2.1-patch1 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ (27.02.2026)

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|---|----------|---------|
| 1 | `ImportError` –≤ `__init__.py` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ pytest | try/except —Å fallback –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã |
| 2 | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `tests/conftest.py` | –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø—É—Ç–µ–π |
| 3 | 6 —Ç–µ—Å—Ç–æ–≤ –ø–∞–¥–∞–ª–∏ –≤ `test_moex_bonds.py` | –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (`has_trades`, `num_trades`) |

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `streamlit-app/__init__.py` ‚Äî fallback –∏–º–ø–æ—Ä—Ç—ã
- `streamlit-app/tests/conftest.py` ‚Äî –Ω–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è pytest
- `streamlit-app/tests/test_moex_bonds.py` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
pytest streamlit-app/tests/ -v
================================
79 passed in 12.34s
```

### Git

- –í–µ—Ç–∫–∞: `fix/v0.2.1-tests-and-imports`
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `mishasya-dev/ofz-spread-analytics`

---

## v0.2.2 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (27.02.2026)

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|---|----------|---------|
| 1 | `FutureWarning: 'H' is deprecated` | `freq='H'` ‚Üí `freq='h'` |
| 2 | –ü—É—Å—Ç–æ–π `except:` –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `(ValueError, TypeError)` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º |
| 3 | **–ú–µ–¥–ª–µ–Ω–Ω—ã–π MOEX API (30+ —Å–µ–∫)** | –ü–∞–∫–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å `fetch_all_market_data()` |
| 4 | `LASTTRADEDATE` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ | –ò—Å–ø–æ–ª—å–∑—É–µ–º `NUMTRADES` / `VALTODAY` |
| 5 | –î—É–±–ª–∏ –æ–±–ª–∏–≥–∞—Ü–∏–π | `seen_isins` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è |
| 6 | O(n¬≤) —Ä–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤ | –£–±—Ä–∞–Ω ‚Äî —Å–ø—Ä–µ–¥—ã –Ω–∞ –ª–µ—Ç—É |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è MOEX API

**–î–æ:**
```
fetch_ofz_only() - –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
fetch_market_data(isin) - N –∑–∞–ø—Ä–æ—Å–æ–≤
LASTTRADEDATE - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**–ü–æ—Å–ª–µ:**
```
fetch_ofz_only() - 1 –∑–∞–ø—Ä–æ—Å
fetch_all_market_data() - 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö
NUMTRADES, VALTODAY - —Ä–∞–±–æ—Ç–∞—é—Ç
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~1.7 —Å–µ–∫ –¥–ª—è 33 –û–§–ó (–±—ã–ª–æ 30+ —Å–µ–∫)

### Intraday —É–ª—É—á—à–µ–Ω–∏—è

| –ò–Ω—Ç–µ—Ä–≤–∞–ª | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|----------|------|-------|
| 1 –º–∏–Ω—É—Ç–∞ | 3 –¥–Ω—è | 3 –¥–Ω—è |
| 10 –º–∏–Ω—É—Ç | 30 –¥–Ω–µ–π | 30 –¥–Ω–µ–π |
| **1 —á–∞—Å** | **30 –¥–Ω–µ–π** | **365 –¥–Ω–µ–π** |

–ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç: ~6 —Å–µ–∫ –¥–ª—è 4000+ —á–∞—Å–æ–≤—ã—Ö —Å–≤–µ—á–µ–π.

### –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ

- **–†–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ë–î** ‚Äî —É–±—Ä–∞–Ω
- –°–ø—Ä–µ–¥—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –ª–µ—Ç—É: `spread = (YTM1 - YTM2) √ó 100`
- –î–ª—è 64 –æ–±–ª–∏–≥–∞—Ü–∏–π: 2016 —Ä–∞—Å—á—ë—Ç–æ–≤ ‚Üí 0

### –¢–µ—Å—Ç—ã

```
tests/run_tests.py:    38/38 ‚úÖ
tests/test_database.py: 38/38 ‚úÖ
tests/test_sidebar.py:  14/14 ‚úÖ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò—Ç–æ–≥–æ:                  90/90 ‚úÖ
```

---

## v0.2.0 ‚Äî –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (27.02.2026)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- –¢–∞–±–ª–∏—Ü–∞ `bonds` –≤ SQLite
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ `@st.dialog` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –û–§–ó-–ü–î, > 0.5 –≥–æ–¥–∞, —Ç–æ—Ä–≥–∏ –∑–∞ 10 –¥–Ω–µ–π
- `is_favorite` –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- –ú–∏–≥—Ä–∞—Ü–∏—è 16 –æ–±–ª–∏–≥–∞—Ü–∏–π –∏–∑ config.py

### –§–∞–π–ª—ã

- `components/bond_manager.py` ‚Äî –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- `api/moex_bonds.py` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏–π —Å MOEX
- `tests/test_sidebar.py` ‚Äî 14 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

---

## v0.1.0 ‚Äî –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (26.02.2026)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- SQLite –ë–î (daily_ytm, intraday_ytm, spreads)
- –î–≤–∞ —Ä–µ–∂–∏–º–∞: daily –∏ intraday
- –†–∞—Å—á—ë—Ç YTM –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π
- –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- 76 —Ç–µ—Å—Ç–æ–≤

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 27.02.2026*

---

## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (27.02.2026)

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
streamlit-app/
‚îú‚îÄ‚îÄ app.py                 # ~1100 —Å—Ç—Ä–æ–∫ ‚Äî –ì–õ–ê–í–ù–´–ô –§–ê–ô–õ (—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π)
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ moex_bonds.py      # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ moex_candles.py    # –°–≤–µ—á–∏ + —Ä–∞—Å—á—ë—Ç YTM
‚îÇ   ‚îú‚îÄ‚îÄ moex_history.py    # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ moex_trading.py    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–≥–æ–≤
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ database.py        # ~1200 —Å—Ç—Ä–æ–∫ ‚Äî –ë–î –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ ytm_calculator.py  # –†–∞—Å—á—ë—Ç YTM
‚îÇ   ‚îú‚îÄ‚îÄ spread.py          # –†–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ signals.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ backtest.py        # –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ bond_manager.py    # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ charts.py          # –ì—Ä–∞—Ñ–∏–∫–∏
‚îú‚îÄ‚îÄ modes/
‚îÇ   ‚îú‚îÄ‚îÄ base.py            # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Ä–µ–∂–∏–º–∞
‚îÇ   ‚îî‚îÄ‚îÄ intraday.py        # Intraday —Ä–µ–∂–∏–º (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ export/
‚îÇ   ‚îú‚îÄ‚îÄ formatters.py      # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ signal_sender.py   # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ tests/                 # 97 —Ç–µ—Å—Ç–æ–≤
```

### –ü—Ä–æ–±–ª–µ–º—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

#### 1. üìÅ **app.py ‚Äî –ë–æ–≥-–æ–±—ä–µ–∫—Ç (~1100 —Å—Ç—Ä–æ–∫)**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Å—å UI –∫–æ–¥ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ. –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏:
```
components/
‚îú‚îÄ‚îÄ sidebar.py          # –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
‚îú‚îÄ‚îÄ header.py           # –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Ä–µ–∂–∏–º—ã
‚îú‚îÄ‚îÄ metrics.py          # –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å–∏–≥–Ω–∞–ª—ã
‚îú‚îÄ‚îÄ charts.py           # –ì—Ä–∞—Ñ–∏–∫–∏ (—É–∂–µ –µ—Å—Ç—å)
‚îú‚îÄ‚îÄ bond_manager.py     # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—É–∂–µ –µ—Å—Ç—å)
‚îî‚îÄ‚îÄ db_panel.py         # –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í—ã—Å–æ–∫–∏–π

---

#### 2. üóÑÔ∏è **database.py ‚Äî –ë–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å (~1200 —Å—Ç—Ä–æ–∫)**

**–ü—Ä–æ–±–ª–µ–º–∞:** DatabaseManager –¥–µ–ª–∞–µ—Ç –≤—Å—ë: –æ–±–ª–∏–≥–∞—Ü–∏–∏, YTM, —Å–≤–µ—á–∏, —Å–ø—Ä–µ–¥—ã, —Å–Ω–∏–º–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
```
core/
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ connection.py    # get_connection, ensure_db_dir
‚îÇ   ‚îú‚îÄ‚îÄ bonds_repo.py    # save_bond, load_bond, get_favorites
‚îÇ   ‚îú‚îÄ‚îÄ ytm_repo.py      # save_daily_ytm, save_intraday_ytm
‚îÇ   ‚îú‚îÄ‚îÄ candles_repo.py  # save_candles, load_candles
‚îÇ   ‚îî‚îÄ‚îÄ spreads_repo.py  # save_spread, load_spreads
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 3. üìä **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** `create_ytm_chart()`, `create_spread_chart()` –≤ app.py, –Ω–æ –µ—Å—Ç—å `components/charts.py`.

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ `components/charts.py`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ChartBuilder.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 4. üîÑ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ session_state**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ session_state:
```python
if 'key' not in st.session_state:
    st.session_state.key = default_value
```

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å-–æ–±—ë—Ä—Ç–∫—É:
```python
# core/session.py
class SessionManager:
    DEFAULTS = {
        'data_mode': 'daily',
        'candle_interval': '60',
        'auto_refresh': False,
        # ...
    }
    
    @classmethod
    def init_defaults(cls):
        for key, value in cls.DEFAULTS.items():
            if key not in st.session_state:
                st.session_state[key] = value
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 5. üß™ **–ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥**

**–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `modes/base.py` ‚Äî BaseMode –∫–ª–∞—Å—Å
- `modes/intraday.py` ‚Äî IntradayMode –∫–ª–∞—Å—Å (–¥—É–±–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –≤ app.py)
- `core/backtest.py` ‚Äî –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥
- `export/signal_sender.py` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–µ—Ç–∫—É/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 6. üìù **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ BondItem/BondConfig**

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- `BondConfig` –≤ config.py (dataclass)
- `BondItem` –≤ app.py (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–ª–∞—Å—Å)
- –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ–±–ª–∏–≥–∞—Ü–∏–∏ –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:** –ï–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å:
```python
# models/bond.py
from dataclasses import dataclass

@dataclass
class Bond:
    isin: str
    name: str
    maturity_date: str
    coupon_rate: float
    face_value: float = 1000
    coupon_frequency: int = 2
    is_favorite: bool = False
    # ...
    
    @classmethod
    def from_db_row(cls, row: dict) -> 'Bond':
        ...
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 7. üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞—Å—Å—ã–ø–∞–Ω–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:
- `MAX_TRADE_DAYS_AGO = 10` –≤ moex_bonds.py
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤ app.py
- –ü–æ—Ä–æ–≥–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ generate_signal()

**–†–µ—à–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å:
```python
# config.py
class AppConfig:
    # MOEX
    MAX_TRADE_DAYS_AGO = 10
    MIN_MATURITY_DAYS = 180
    
    # Intervals
    INTRADAY_INTERVALS = {
        '1': {'max_days': 3, 'default': 1},
        '10': {'max_days': 30, 'default': 7},
        '60': {'max_days': 365, 'default': 30},
    }
    
    # Signals
    SIGNAL_THRESHOLDS = {
        'p10': 0.10,
        'p25': 0.25,
        'p75': 0.75,
        'p90': 0.90,
    }
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 8. ‚ö†Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ –º–µ—Å—Ç —Å –ø—É—Å—Ç—ã–º `except:` –∏–ª–∏ –æ–±—â–∏–º `except Exception`.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
```python
# core/exceptions.py
class OFZError(Exception):
    """–ë–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ"""

class MOEXAPIError(OFZError):
    """–û—à–∏–±–∫–∞ MOEX API"""

class YTMCalculationError(OFZError):
    """–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ YTM"""
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 9. üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: fetch_candle_data_cached**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –∫—ç—à–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. ~120 —Å—Ç—Ä–æ–∫.

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å:
```python
# services/candle_service.py
class CandleService:
    def __init__(self, fetcher, db):
        self.fetcher = fetcher
        self.db = db
    
    def get_candles_with_ytm(self, isin, interval, days) -> pd.DataFrame:
        ...
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 10. üßπ **Type hints**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø–æ–ª–Ω—ã–µ type hints, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è pandas DataFrame.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å type hints, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypedDict:
```python
from typing import TypedDict

class BondData(TypedDict):
    isin: str
    name: str
    ytm: float
    duration_years: float
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

| # | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ | –í–ª–∏—è–Ω–∏–µ |
|---|-----------|-----------|--------|---------|
| 1 | –†–∞–∑–±–∏—Ç—å app.py | üî¥ –í—ã—Å–æ–∫–∏–π | 4—á | –£–ª—É—á—à–∏—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å |
| 2 | –†–∞–∑–±–∏—Ç—å database.py | üü° –°—Ä–µ–¥–Ω–∏–π | 3—á | –£–ª—É—á—à–∏—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å |
| 3 | –ì—Ä–∞—Ñ–∏–∫–∏ –≤ charts.py | üü¢ –ù–∏–∑–∫–∏–π | 1—á | DRY |
| 4 | SessionManager | üü¢ –ù–∏–∑–∫–∏–π | 1—á | DRY |
| 5 | –£–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ | üü° –°—Ä–µ–¥–Ω–∏–π | 30–º–∏–Ω | –ß–∏—Å—Ç–æ—Ç–∞ |
| 6 | –ï–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å Bond | üü° –°—Ä–µ–¥–Ω–∏–π | 2—á | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| 7 | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ | üü¢ –ù–∏–∑–∫–∏–π | 1—á | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ |
| 8 | –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | üü° –°—Ä–µ–¥–Ω–∏–π | 2—á | –û—Ç–ª–∞–¥–∫–∞ |
| 9 | CandleService | üü° –°—Ä–µ–¥–Ω–∏–π | 2—á | –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å |
| 10 | Type hints | üü¢ –ù–∏–∑–∫–∏–π | 2—á | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–§–∞–∑–∞ 1: –û—á–∏—Å—Ç–∫–∞ (1 —á–∞—Å)**
- –£–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (modes/, export/signal_sender.py, backtest.py)

**–§–∞–∑–∞ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (4-5 —á–∞—Å–æ–≤)**
- –†–∞–∑–±–∏—Ç—å app.py –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –í—ã–Ω–µ—Å—Ç–∏ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ charts.py

**–§–∞–∑–∞ 3: –ú–æ–¥–µ–ª–∏ (3-4 —á–∞—Å–∞)**
- –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é –º–æ–¥–µ–ª—å Bond
- –†–∞–∑–±–∏—Ç—å DatabaseManager –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**–§–∞–∑–∞ 4: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (3-4 —á–∞—Å–∞)**
- SessionManager
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- Type hints
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

---

*–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω: 27.02.2026*

---

## v0.3.0 ‚Äî Unified Charts (27.02.2026)

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

#### 1. –ù–æ–≤—ã–π UI —Å 4 –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

–£–±—Ä–∞–Ω —Ä–µ–∂–∏–º daily/intraday. –¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è 4 —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞:

| –ì—Ä–∞—Ñ–∏–∫ | –î–∞–Ω–Ω—ã–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|--------|------------|
| 1 | YTM –¥–Ω–µ–≤–Ω—ã–µ (YIELDCLOSE) | –ò—Å—Ç–æ—Ä–∏—è + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| 2 | –°–ø—Ä–µ–¥ –¥–Ω–µ–≤–Ω–æ–π | –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏, —Å—Ä–µ–¥–Ω–µ–µ |
| 3 | YTM —Å–∫–ª–µ–µ–Ω–Ω—ã–π | –ò—Å—Ç–æ—Ä–∏—è + —Å–≤–µ—á–∏ (intraday) |
| 4 | –°–ø—Ä–µ–¥ intraday | –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ –æ—Ç –¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |

#### 2. –°–≤—è–∑–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ (Linked Zoom)

- –ì—Ä–∞—Ñ–∏–∫–∏ 1-2 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ zoom
- –ì—Ä–∞—Ñ–∏–∫–∏ 3-4 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ zoom
- –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞ –æ–¥–Ω–æ–º ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π zoom –Ω–∞ –≤—Ç–æ—Ä–æ–º

#### 3. –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

| –≠–ª–µ–º–µ–Ω—Ç | –ò—Å—Ç–æ—Ä–∏—è | –°–≤–µ—á–∏ |
|---------|---------|-------|
| –û–±–ª–∏–≥–∞—Ü–∏—è 1 | –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π `#1a5276` | –Ø—Ä–∫–æ-—Å–∏–Ω–∏–π `#3498DB` |
| –û–±–ª–∏–≥–∞—Ü–∏—è 2 | –¢—ë–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π `#922B21` | –Ø—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–π `#E74C3C` |
| –°–ø—Ä–µ–¥ | –§–∏–æ–ª–µ—Ç–æ–≤—ã–π `#9B59B6` | ‚Äî |

#### 4. –ï–¥–∏–Ω—ã–π –ø–µ—Ä–∏–æ–¥

- –û–¥–∏–Ω —Å–ª–∞–π–¥–µ—Ä: 1 –º–µ—Å—è—Ü ‚Äî 2 –≥–æ–¥–∞
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 –≥–æ–¥
- 15% –º–µ—Å—Ç–∞ –¥–ª—è "–±—É–¥—É—â–µ–≥–æ" –Ω–∞ –æ—Å–∏ X

#### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

- –ü–µ—Ä–∏–æ–¥ 2 –≥–æ–¥–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª –≥—Ä–∞—Ñ–∏–∫–∏ (fixed)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–ø—Ä–µ–¥–∞ –∏—Å–∫–∞–∂–∞–ª–∞—Å—å –≤ intraday —Ä–µ–∂–∏–º–µ (fixed: —Ç–µ–ø–µ—Ä—å –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ –æ—Ç –¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

### Git

- –í–µ—Ç–∫–∞: `feature/v0.3.0-unified-charts`
- –ö–æ–º–º–∏—Ç: `2ced4bb`
- Push: https://github.com/mishasya-dev/ofz-spread-analytics

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 27.02.2026*
