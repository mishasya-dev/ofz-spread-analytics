# OFZ Spread Analytics - –ñ—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç—ã

## v0.2.1-patch1 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ (27.02.2026)

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|---|----------|---------|
| 1 | `ImportError` –≤ `__init__.py` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ pytest | try/except —Å fallback –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã |
| 2 | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `tests/conftest.py` | –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø—É—Ç–µ–π |
| 3 | 6 —Ç–µ—Å—Ç–æ–≤ –ø–∞–¥–∞–ª–∏ –≤ `test_moex_bonds.py` | –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (`has_trades`, `num_trades`) |

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `streamlit-app/__init__.py` ‚Äî fallback –∏–º–ø–æ—Ä—Ç—ã
- `streamlit-app/tests/conftest.py` ‚Äî –Ω–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è pytest
- `streamlit-app/tests/test_moex_bonds.py` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
pytest streamlit-app/tests/ -v
================================
79 passed in 12.34s
```

### Git

- –í–µ—Ç–∫–∞: `fix/v0.2.1-tests-and-imports`
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `mishasya-dev/ofz-spread-analytics`

---

## v0.2.2 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (27.02.2026)

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|---|----------|---------|
| 1 | `FutureWarning: 'H' is deprecated` | `freq='H'` ‚Üí `freq='h'` |
| 2 | –ü—É—Å—Ç–æ–π `except:` –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `(ValueError, TypeError)` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º |
| 3 | **–ú–µ–¥–ª–µ–Ω–Ω—ã–π MOEX API (30+ —Å–µ–∫)** | –ü–∞–∫–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å `fetch_all_market_data()` |
| 4 | `LASTTRADEDATE` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ | –ò—Å–ø–æ–ª—å–∑—É–µ–º `NUMTRADES` / `VALTODAY` |
| 5 | –î—É–±–ª–∏ –æ–±–ª–∏–≥–∞—Ü–∏–π | `seen_isins` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è |
| 6 | O(n¬≤) —Ä–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤ | –£–±—Ä–∞–Ω ‚Äî —Å–ø—Ä–µ–¥—ã –Ω–∞ –ª–µ—Ç—É |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è MOEX API

**–î–æ:**
```
fetch_ofz_only() - –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
fetch_market_data(isin) - N –∑–∞–ø—Ä–æ—Å–æ–≤
LASTTRADEDATE - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**–ü–æ—Å–ª–µ:**
```
fetch_ofz_only() - 1 –∑–∞–ø—Ä–æ—Å
fetch_all_market_data() - 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö
NUMTRADES, VALTODAY - —Ä–∞–±–æ—Ç–∞—é—Ç
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~1.7 —Å–µ–∫ –¥–ª—è 33 –û–§–ó (–±—ã–ª–æ 30+ —Å–µ–∫)

### Intraday —É–ª—É—á—à–µ–Ω–∏—è

| –ò–Ω—Ç–µ—Ä–≤–∞–ª | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|----------|------|-------|
| 1 –º–∏–Ω—É—Ç–∞ | 3 –¥–Ω—è | 3 –¥–Ω—è |
| 10 –º–∏–Ω—É—Ç | 30 –¥–Ω–µ–π | 30 –¥–Ω–µ–π |
| **1 —á–∞—Å** | **30 –¥–Ω–µ–π** | **365 –¥–Ω–µ–π** |

–ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç: ~6 —Å–µ–∫ –¥–ª—è 4000+ —á–∞—Å–æ–≤—ã—Ö —Å–≤–µ—á–µ–π.

### –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–µ–≥–æ

- **–†–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ë–î** ‚Äî —É–±—Ä–∞–Ω
- –°–ø—Ä–µ–¥—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –ª–µ—Ç—É: `spread = (YTM1 - YTM2) √ó 100`
- –î–ª—è 64 –æ–±–ª–∏–≥–∞—Ü–∏–π: 2016 —Ä–∞—Å—á—ë—Ç–æ–≤ ‚Üí 0

### –¢–µ—Å—Ç—ã

```
tests/run_tests.py:    38/38 ‚úÖ
tests/test_database.py: 38/38 ‚úÖ
tests/test_sidebar.py:  14/14 ‚úÖ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò—Ç–æ–≥–æ:                  90/90 ‚úÖ
```

---

## v0.2.0 ‚Äî –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (27.02.2026)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- –¢–∞–±–ª–∏—Ü–∞ `bonds` –≤ SQLite
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ `@st.dialog` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –û–§–ó-–ü–î, > 0.5 –≥–æ–¥–∞, —Ç–æ—Ä–≥–∏ –∑–∞ 10 –¥–Ω–µ–π
- `is_favorite` –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- –ú–∏–≥—Ä–∞—Ü–∏—è 16 –æ–±–ª–∏–≥–∞—Ü–∏–π –∏–∑ config.py

### –§–∞–π–ª—ã

- `components/bond_manager.py` ‚Äî –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- `api/moex_bonds.py` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏–π —Å MOEX
- `tests/test_sidebar.py` ‚Äî 14 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

---

## v0.1.0 ‚Äî –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (26.02.2026)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- SQLite –ë–î (daily_ytm, intraday_ytm, spreads)
- –î–≤–∞ —Ä–µ–∂–∏–º–∞: daily –∏ intraday
- –†–∞—Å—á—ë—Ç YTM –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π
- –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- 76 —Ç–µ—Å—Ç–æ–≤

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 27.02.2026*

---

## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (27.02.2026)

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
streamlit-app/
‚îú‚îÄ‚îÄ app.py                 # ~1100 —Å—Ç—Ä–æ–∫ ‚Äî –ì–õ–ê–í–ù–´–ô –§–ê–ô–õ (—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π)
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ moex_bonds.py      # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ moex_candles.py    # –°–≤–µ—á–∏ + —Ä–∞—Å—á—ë—Ç YTM
‚îÇ   ‚îú‚îÄ‚îÄ moex_history.py    # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ moex_trading.py    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–≥–æ–≤
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ database.py        # ~1200 —Å—Ç—Ä–æ–∫ ‚Äî –ë–î –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ ytm_calculator.py  # –†–∞—Å—á—ë—Ç YTM
‚îÇ   ‚îú‚îÄ‚îÄ spread.py          # –†–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ signals.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ backtest.py        # –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ bond_manager.py    # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ charts.py          # –ì—Ä–∞—Ñ–∏–∫–∏
‚îú‚îÄ‚îÄ modes/
‚îÇ   ‚îú‚îÄ‚îÄ base.py            # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Ä–µ–∂–∏–º–∞
‚îÇ   ‚îî‚îÄ‚îÄ intraday.py        # Intraday —Ä–µ–∂–∏–º (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ export/
‚îÇ   ‚îú‚îÄ‚îÄ formatters.py      # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ signal_sender.py   # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ tests/                 # 97 —Ç–µ—Å—Ç–æ–≤
```

### –ü—Ä–æ–±–ª–µ–º—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

#### 1. üìÅ **app.py ‚Äî –ë–æ–≥-–æ–±—ä–µ–∫—Ç (~1100 —Å—Ç—Ä–æ–∫)**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Å—å UI –∫–æ–¥ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ. –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏:
```
components/
‚îú‚îÄ‚îÄ sidebar.py          # –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
‚îú‚îÄ‚îÄ header.py           # –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Ä–µ–∂–∏–º—ã
‚îú‚îÄ‚îÄ metrics.py          # –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å–∏–≥–Ω–∞–ª—ã
‚îú‚îÄ‚îÄ charts.py           # –ì—Ä–∞—Ñ–∏–∫–∏ (—É–∂–µ –µ—Å—Ç—å)
‚îú‚îÄ‚îÄ bond_manager.py     # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—É–∂–µ –µ—Å—Ç—å)
‚îî‚îÄ‚îÄ db_panel.py         # –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í—ã—Å–æ–∫–∏–π

---

#### 2. üóÑÔ∏è **database.py ‚Äî –ë–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å (~1200 —Å—Ç—Ä–æ–∫)**

**–ü—Ä–æ–±–ª–µ–º–∞:** DatabaseManager –¥–µ–ª–∞–µ—Ç –≤—Å—ë: –æ–±–ª–∏–≥–∞—Ü–∏–∏, YTM, —Å–≤–µ—á–∏, —Å–ø—Ä–µ–¥—ã, —Å–Ω–∏–º–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
```
core/
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ connection.py    # get_connection, ensure_db_dir
‚îÇ   ‚îú‚îÄ‚îÄ bonds_repo.py    # save_bond, load_bond, get_favorites
‚îÇ   ‚îú‚îÄ‚îÄ ytm_repo.py      # save_daily_ytm, save_intraday_ytm
‚îÇ   ‚îú‚îÄ‚îÄ candles_repo.py  # save_candles, load_candles
‚îÇ   ‚îî‚îÄ‚îÄ spreads_repo.py  # save_spread, load_spreads
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 3. üìä **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** `create_ytm_chart()`, `create_spread_chart()` –≤ app.py, –Ω–æ –µ—Å—Ç—å `components/charts.py`.

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ `components/charts.py`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ChartBuilder.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 4. üîÑ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ session_state**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ session_state:
```python
if 'key' not in st.session_state:
    st.session_state.key = default_value
```

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å-–æ–±—ë—Ä—Ç–∫—É:
```python
# core/session.py
class SessionManager:
    DEFAULTS = {
        'data_mode': 'daily',
        'candle_interval': '60',
        'auto_refresh': False,
        # ...
    }
    
    @classmethod
    def init_defaults(cls):
        for key, value in cls.DEFAULTS.items():
            if key not in st.session_state:
                st.session_state[key] = value
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 5. üß™ **–ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥**

**–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `modes/base.py` ‚Äî BaseMode –∫–ª–∞—Å—Å
- `modes/intraday.py` ‚Äî IntradayMode –∫–ª–∞—Å—Å (–¥—É–±–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –≤ app.py)
- `core/backtest.py` ‚Äî –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥
- `export/signal_sender.py` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–µ—Ç–∫—É/—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 6. üìù **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ BondItem/BondConfig**

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- `BondConfig` –≤ config.py (dataclass)
- `BondItem` –≤ app.py (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–ª–∞—Å—Å)
- –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ–±–ª–∏–≥–∞—Ü–∏–∏ –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:** –ï–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å:
```python
# models/bond.py
from dataclasses import dataclass

@dataclass
class Bond:
    isin: str
    name: str
    maturity_date: str
    coupon_rate: float
    face_value: float = 1000
    coupon_frequency: int = 2
    is_favorite: bool = False
    # ...
    
    @classmethod
    def from_db_row(cls, row: dict) -> 'Bond':
        ...
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 7. üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞—Å—Å—ã–ø–∞–Ω–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:
- `MAX_TRADE_DAYS_AGO = 10` –≤ moex_bonds.py
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤ app.py
- –ü–æ—Ä–æ–≥–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ generate_signal()

**–†–µ—à–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å:
```python
# config.py
class AppConfig:
    # MOEX
    MAX_TRADE_DAYS_AGO = 10
    MIN_MATURITY_DAYS = 180
    
    # Intervals
    INTRADAY_INTERVALS = {
        '1': {'max_days': 3, 'default': 1},
        '10': {'max_days': 30, 'default': 7},
        '60': {'max_days': 365, 'default': 30},
    }
    
    # Signals
    SIGNAL_THRESHOLDS = {
        'p10': 0.10,
        'p25': 0.25,
        'p75': 0.75,
        'p90': 0.90,
    }
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

#### 8. ‚ö†Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–æ –º–µ—Å—Ç —Å –ø—É—Å—Ç—ã–º `except:` –∏–ª–∏ –æ–±—â–∏–º `except Exception`.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
```python
# core/exceptions.py
class OFZError(Exception):
    """–ë–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ"""

class MOEXAPIError(OFZError):
    """–û—à–∏–±–∫–∞ MOEX API"""

class YTMCalculationError(OFZError):
    """–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ YTM"""
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 9. üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: fetch_candle_data_cached**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –∫—ç—à–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. ~120 —Å—Ç—Ä–æ–∫.

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å:
```python
# services/candle_service.py
class CandleService:
    def __init__(self, fetcher, db):
        self.fetcher = fetcher
        self.db = db
    
    def get_candles_with_ytm(self, isin, interval, days) -> pd.DataFrame:
        ...
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

---

#### 10. üßπ **Type hints**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø–æ–ª–Ω—ã–µ type hints, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è pandas DataFrame.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å type hints, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypedDict:
```python
from typing import TypedDict

class BondData(TypedDict):
    isin: str
    name: str
    ytm: float
    duration_years: float
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π

---

### –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

| # | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ | –í–ª–∏—è–Ω–∏–µ |
|---|-----------|-----------|--------|---------|
| 1 | –†–∞–∑–±–∏—Ç—å app.py | üî¥ –í—ã—Å–æ–∫–∏–π | 4—á | –£–ª—É—á—à–∏—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å |
| 2 | –†–∞–∑–±–∏—Ç—å database.py | üü° –°—Ä–µ–¥–Ω–∏–π | 3—á | –£–ª—É—á—à–∏—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å |
| 3 | –ì—Ä–∞—Ñ–∏–∫–∏ –≤ charts.py | üü¢ –ù–∏–∑–∫–∏–π | 1—á | DRY |
| 4 | SessionManager | üü¢ –ù–∏–∑–∫–∏–π | 1—á | DRY |
| 5 | –£–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ | üü° –°—Ä–µ–¥–Ω–∏–π | 30–º–∏–Ω | –ß–∏—Å—Ç–æ—Ç–∞ |
| 6 | –ï–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å Bond | üü° –°—Ä–µ–¥–Ω–∏–π | 2—á | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| 7 | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ | üü¢ –ù–∏–∑–∫–∏–π | 1—á | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ |
| 8 | –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è | üü° –°—Ä–µ–¥–Ω–∏–π | 2—á | –û—Ç–ª–∞–¥–∫–∞ |
| 9 | CandleService | üü° –°—Ä–µ–¥–Ω–∏–π | 2—á | –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å |
| 10 | Type hints | üü¢ –ù–∏–∑–∫–∏–π | 2—á | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–§–∞–∑–∞ 1: –û—á–∏—Å—Ç–∫–∞ (1 —á–∞—Å)**
- –£–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (modes/, export/signal_sender.py, backtest.py)

**–§–∞–∑–∞ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (4-5 —á–∞—Å–æ–≤)**
- –†–∞–∑–±–∏—Ç—å app.py –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –í—ã–Ω–µ—Å—Ç–∏ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ charts.py

**–§–∞–∑–∞ 3: –ú–æ–¥–µ–ª–∏ (3-4 —á–∞—Å–∞)**
- –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é –º–æ–¥–µ–ª—å Bond
- –†–∞–∑–±–∏—Ç—å DatabaseManager –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**–§–∞–∑–∞ 4: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (3-4 —á–∞—Å–∞)**
- SessionManager
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- Type hints
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

---

*–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω: 27.02.2026*

---

## v0.3.0-patch1 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TypeError slider (28.02.2026)

### –ü—Ä–æ–±–ª–µ–º–∞

```
TypeError: SliderMixin.slider() got an unexpected keyword argument 'format_func'
```

### –ü—Ä–∏—á–∏–Ω–∞

`st.slider()` –≤ Streamlit –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `format_func`.
–≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è `st.selectbox()` –∏ `st.radio()`.

### –†–µ—à–µ–Ω–∏–µ

```python
# –ë—ã–ª–æ (–æ—à–∏–±–∫–∞):
period = st.slider(
    "–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞",
    format_func=lambda x: f"{x // 30} –º–µ—Å." if x < 365 else f"{x // 365} –≥–æ–¥(–∞)"
)

# –°—Ç–∞–ª–æ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
period = st.slider(
    "–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ (–¥–Ω–µ–π)",
    format="%d –¥–Ω–µ–π"
)
```

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app.py` ‚Äî —Å—Ç—Ä–æ–∫–∏ 544-551

### –¢–µ—Å—Ç—ã

```
97 passed, 12 errors (Playwright tests require setup)
```

### Git

- –í–µ—Ç–∫–∞: `feature/v0.3.0-unified-charts`
- –ö–æ–º–º–∏—Ç: `5db51aa`
- Push: https://github.com/mishasya-dev/ofz-spread-analytics

---

## v0.3.0-refactor1 ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ sidebar.py (28.02.2026)

### –ò–∑–º–µ–Ω–µ–Ω–∏—è

–û–±–Ω–æ–≤–ª—ë–Ω `components/sidebar.py` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è v0.3.0 unified charts:

| –§—É–Ω–∫—Ü–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----------|
| `render_period_selector()` | –û–¥–∏–Ω —Å–ª–∞–π–¥–µ—Ä –ø–µ—Ä–∏–æ–¥–∞ (30-730 –¥–Ω–µ–π) |
| `render_candle_interval_selector()` | **–ù–æ–≤–∞—è** ‚Äî –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å–≤–µ—á–µ–π |
| `render_db_panel()` | **–ù–æ–≤–∞—è** ‚Äî –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î |
| `render_cache_clear()` | **–ù–æ–≤–∞—è** ‚Äî –∫–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ |
| `render_sidebar()` | **–ù–æ–≤–∞—è** ‚Äî –≥–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ |
| `render_intraday_options()` | **–£–¥–∞–ª–µ–Ω–∞** ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞ |

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `components/sidebar.py` ‚Äî –ø–æ–ª–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- `components/__init__.py` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç—ã

### –¢–µ—Å—Ç—ã

```
97 passed
```

### Git

- –ö–æ–º–º–∏—Ç: `29c71d9`

---

## v0.3.0-tests ‚Äî –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (28.02.2026)

### –ù–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç |
|------|--------|---------------|
| `test_charts_v030.py` | 28 | –ù–æ–≤—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ v0.3.0 |
| `test_models_bond.py` | 26 | –ú–æ–¥–µ–ª—å Bond (dataclass) |

### –ü–æ–∫—Ä—ã—Ç–∏–µ test_charts_v030.py

- `calculate_future_range()` ‚Äî —Ä–∞—Å—á—ë—Ç –æ—Å–∏ X —Å –∑–∞–ø–∞—Å–æ–º
- `create_daily_ytm_chart()` ‚Äî –≥—Ä–∞—Ñ–∏–∫ YTM –ø–æ –¥–Ω–µ–≤–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- `create_daily_spread_chart()` ‚Äî –≥—Ä–∞—Ñ–∏–∫ —Å–ø—Ä–µ–¥–∞ —Å –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è–º–∏
- `create_combined_ytm_chart()` ‚Äî —Å–∫–ª–µ–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (–∏—Å—Ç–æ—Ä–∏—è + —Å–≤–µ—á–∏)
- `create_intraday_spread_chart()` ‚Äî intraday —Å–ø—Ä–µ–¥ —Å —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–º

### –ü–æ–∫—Ä—ã—Ç–∏–µ test_models_bond.py

- Bond dataclass: —Å–æ–∑–¥–∞–Ω–∏–µ, defaults
- `Bond.from_dict()` / `from_db_row()` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- `Bond.to_dict()` / `to_db_dict()` ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `get_years_to_maturity()` ‚Äî —Ä–∞—Å—á—ë—Ç –ª–µ—Ç –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è
- `format_label()` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∫–∏
- BondPair: —Ä–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–∞

### –ò—Ç–æ–≥–æ

```
–ë—ã–ª–æ:  97 —Ç–µ—Å—Ç–æ–≤
–°—Ç–∞–ª–æ: 151 —Ç–µ—Å—Ç (+54)
```

### Git

- –ö–æ–º–º–∏—Ç: `756b986`

---

## v0.3.0 ‚Äî Unified Charts (27.02.2026)

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

#### 1. –ù–æ–≤—ã–π UI —Å 4 –≥—Ä–∞—Ñ–∏–∫–∞–º–∏

–£–±—Ä–∞–Ω —Ä–µ–∂–∏–º daily/intraday. –¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è 4 —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞:

| –ì—Ä–∞—Ñ–∏–∫ | –î–∞–Ω–Ω—ã–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|--------|------------|
| 1 | YTM –¥–Ω–µ–≤–Ω—ã–µ (YIELDCLOSE) | –ò—Å—Ç–æ—Ä–∏—è + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| 2 | –°–ø—Ä–µ–¥ –¥–Ω–µ–≤–Ω–æ–π | –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏, —Å—Ä–µ–¥–Ω–µ–µ |
| 3 | YTM —Å–∫–ª–µ–µ–Ω–Ω—ã–π | –ò—Å—Ç–æ—Ä–∏—è + —Å–≤–µ—á–∏ (intraday) |
| 4 | –°–ø—Ä–µ–¥ intraday | –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ –æ—Ç –¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |

#### 2. –°–≤—è–∑–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ (Linked Zoom)

- –ì—Ä–∞—Ñ–∏–∫–∏ 1-2 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ zoom
- –ì—Ä–∞—Ñ–∏–∫–∏ 3-4 —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ zoom
- –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞ –æ–¥–Ω–æ–º ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π zoom –Ω–∞ –≤—Ç–æ—Ä–æ–º

#### 3. –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

| –≠–ª–µ–º–µ–Ω—Ç | –ò—Å—Ç–æ—Ä–∏—è | –°–≤–µ—á–∏ |
|---------|---------|-------|
| –û–±–ª–∏–≥–∞—Ü–∏—è 1 | –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π `#1a5276` | –Ø—Ä–∫–æ-—Å–∏–Ω–∏–π `#3498DB` |
| –û–±–ª–∏–≥–∞—Ü–∏—è 2 | –¢—ë–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π `#922B21` | –Ø—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–π `#E74C3C` |
| –°–ø—Ä–µ–¥ | –§–∏–æ–ª–µ—Ç–æ–≤—ã–π `#9B59B6` | ‚Äî |

#### 4. –ï–¥–∏–Ω—ã–π –ø–µ—Ä–∏–æ–¥

- –û–¥–∏–Ω —Å–ª–∞–π–¥–µ—Ä: 1 –º–µ—Å—è—Ü ‚Äî 2 –≥–æ–¥–∞
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 –≥–æ–¥
- 15% –º–µ—Å—Ç–∞ –¥–ª—è "–±—É–¥—É—â–µ–≥–æ" –Ω–∞ –æ—Å–∏ X

#### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

- –ü–µ—Ä–∏–æ–¥ 2 –≥–æ–¥–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª –≥—Ä–∞—Ñ–∏–∫–∏ (fixed)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–ø—Ä–µ–¥–∞ –∏—Å–∫–∞–∂–∞–ª–∞—Å—å –≤ intraday —Ä–µ–∂–∏–º–µ (fixed: —Ç–µ–ø–µ—Ä—å –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ –æ—Ç –¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

### Git

- –í–µ—Ç–∫–∞: `feature/v0.3.0-unified-charts`
- –ö–æ–º–º–∏—Ç: `2ced4bb`
- Push: https://github.com/mishasya-dev/ofz-spread-analytics

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 27.02.2026*

---

## v0.3.0-tests2 ‚Äî –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (28.02.2026)

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

#### 1. –ù–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç |
|------|--------|---------------|
| `test_candle_service.py` | 36 | CandleService |
| `test_db_repositories.py` | 23 | BondsRepository, YTMRepository, SpreadsRepository |
| `test_app_v030.py` | 20 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (spread, signals, labels) |

#### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –≤–∏–¥–Ω–æ, —á—Ç–æ –∏—Å—Ç–æ—Ä–∏—è –∏ —Å–≤–µ—á–∏ –Ω–µ—Ä–∞–∑–ª–∏—á–∏–º—ã - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ü–≤–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å—Ç–æ—Ä–∏—è: —Ç—ë–º–Ω—ã–π —Ü–≤–µ—Ç + –ø—É–Ω–∫—Ç–∏—Ä (`dash='dash'`) + –º–µ—Ç–∫–∞ "(–¥–Ω–µ–≤–Ω.)"
- –°–≤–µ—á–∏: —è—Ä–∫–∏–π —Ü–≤–µ—Ç + —Å–ø–ª–æ—à–Ω–∞—è –ª–∏–Ω–∏—è + –º–µ—Ç–∫–∞ "(—Å–≤–µ—á–∏)"
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ—Ç–∫–∞ –Ω–∞ –≤—Å–µ 4 –≥—Ä–∞—Ñ–∏–∫–∞

```python
# –ë—ã–ª–æ:
line=dict(color=BOND1_COLORS["history"], width=2)

# –°—Ç–∞–ª–æ:
line=dict(color=BOND1_COLORS["history"], width=2, dash='dash'),
opacity=0.8
```

#### 3. –ò—Ç–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
–î–æ:    198 —Ç–µ—Å—Ç–æ–≤
–ü–æ—Å–ª–µ: 277 —Ç–µ—Å—Ç–æ–≤ (+79)
```

### Git

- –í–µ—Ç–∫–∞: `feature/v0.3.0-unified-charts`
- –ö–æ–º–º–∏—Ç: `0cc19af`
- Push: https://github.com/mishasya-dev/ofz-spread-analytics

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (TODO)

### 1. –§–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `requirements.txt` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `requirements-dev.txt` ‚Äî –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `requirements-lock.txt` —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pip-compile` –æ—Ç pip-tools

---

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –í—ã—Å–æ–∫–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ MOEX –Ω–µ –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã–µ –∑–∞ –¥–µ–Ω—å ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏.

**–ì–¥–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
- `app.py:fetch_historical_data_cached()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
- `app.py:fetch_candle_data_cached()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
- –†–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–∞ ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å NaN

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
if df.empty:
    st.warning("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥")
    return pd.DataFrame()

# –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤
df = df.interpolate()

# Fallback –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ
if pd.isna(current_value):
    current_value = df['ytm'].iloc[-1]
```

---

### 3. –•–∞—Ä–¥–∫–æ–¥ –ø—É—Ç–µ–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°—Ä–µ–¥–Ω–∏–π

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:**
```
core/db/connection.py: DB_PATH = ".../data/ofz_data.db"
core/database.py:       DB_PATH = ".../data/ofz_data.db"
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
# config.py
import os
from pathlib import Path

BASE_DIR = Path(__file__).parent
DATA_DIR = BASE_DIR / "data"
DB_PATH = DATA_DIR / "ofz_data.db"

# –ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
DB_PATH = os.environ.get("OFZ_DB_PATH", "data/ofz_data.db")
```

---

### –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] `requirements-lock.txt` —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ fetch_historical_data_cached()
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ fetch_candle_data_cached()
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ NaN –≤ —Ä–∞—Å—á—ë—Ç–µ —Å–ø—Ä–µ–¥–∞
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–µ–π –≤ config.py
- [ ] –£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –∏–∑ core/db/connection.py
- [ ] –£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –∏–∑ core/database.py

---

*–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã: 27.02.2026*

---

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (28.02.2026)

### Git

- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/mishasya-dev/ofz-spread-analytics
- **–í–µ—Ç–∫–∞:** `feature/v0.3.0-unified-charts`
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç:** `0cc19af`
- **–¢–æ–∫–µ–Ω:** –í—Å—Ç—Ä–æ–µ–Ω –≤ git remote URL

### –¢–µ—Å—Ç—ã

```
–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 277
–ü—Ä–æ—à–ª–∏:       277 ‚úÖ
–û—à–∏–±–∫–∏:       12 (Playwright UI - –Ω—É–∂–Ω—ã –±—Ä–∞—É–∑–µ—Ä—ã)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ |
|------|--------|
| test_database.py | ~100 |
| test_sidebar_v030.py | 36 |
| test_candle_service.py | 36 |
| test_moex_bonds.py | 34 |
| test_bond_manager.py | 31 |
| test_charts_v030.py | 28 |
| test_models_bond.py | 26 |
| test_bonds.py | 22 |
| test_app_v030.py | 20 |
| test_sidebar.py | 14 |
| test_ytm_calculation.py | 6 |

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ì—Ä–∞—Ñ–∏–∫–∏ (charts.py)**
   - –ò—Å—Ç–æ—Ä–∏—è: –ø—É–Ω–∫—Ç–∏—Ä + –º–µ—Ç–∫–∞ "(–¥–Ω–µ–≤–Ω.)"
   - –°–≤–µ—á–∏: —Å–ø–ª–æ—à–Ω–∞—è + –º–µ—Ç–∫–∞ "(—Å–≤–µ—á–∏)"
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ—Ç–∫–∞ –Ω–∞ –≤—Å–µ 4 –≥—Ä–∞—Ñ–∏–∫–∞

2. **–ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã**
   - test_candle_service.py (36 —Ç–µ—Å—Ç–æ–≤)
   - test_db_repositories.py (23 —Ç–µ—Å—Ç–∞)
   - test_app_v030.py (20 —Ç–µ—Å—Ç–æ–≤)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **–ü—É—Ç—å:** `streamlit-app/data/ofz_data.db`
- **–¢–∞–±–ª–∏—Ü—ã:** bonds, daily_ytm, intraday_ytm, spreads
- **–û–±–ª–∏–≥–∞—Ü–∏–π:** 16
- **–î–Ω–µ–≤–Ω—ã—Ö YTM:** ~821 –∑–∞–ø–∏—Å–µ–π

### –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

```
streamlit-app/
‚îú‚îÄ‚îÄ app.py                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (~1100 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ api/                      # MOEX API
‚îÇ   ‚îú‚îÄ‚îÄ moex_bonds.py
‚îÇ   ‚îú‚îÄ‚îÄ moex_candles.py
‚îÇ   ‚îú‚îÄ‚îÄ moex_history.py
‚îÇ   ‚îî‚îÄ‚îÄ moex_trading.py
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ database.py           # DatabaseManager
‚îÇ   ‚îú‚îÄ‚îÄ db/                   # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bonds_repo.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ytm_repo.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ spreads_repo.py
‚îÇ   ‚îú‚îÄ‚îÄ ytm_calculator.py
‚îÇ   ‚îú‚îÄ‚îÄ spread.py
‚îÇ   ‚îú‚îÄ‚îÄ signals.py
‚îÇ   ‚îî‚îÄ‚îÄ session.py
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ sidebar.py            # –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ charts.py             # –ì—Ä–∞—Ñ–∏–∫–∏ Plotly
‚îÇ   ‚îú‚îÄ‚îÄ bond_manager.py       # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
‚îÇ   ‚îî‚îÄ‚îÄ metrics.py
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ bond.py               # Bond dataclass
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ candle_service.py
‚îî‚îÄ‚îÄ tests/                    # 277 —Ç–µ—Å—Ç–æ–≤
```

### –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏

1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** (–∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã—à–µ):
   - –†–∞–∑–±–∏—Ç—å app.py –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - –£–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (modes/, backtest.py)
   
2. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**:
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö MOEX
   - requirements-lock.txt

---

## v0.3.0-bugfix1 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è YTM (28.02.2026)

### –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ 3-–º –≥—Ä–∞—Ñ–∏–∫–µ (YTM –∏—Å—Ç–æ—Ä–∏—è + —Å–≤–µ—á–∏) –Ω–∞–±–ª—é–¥–∞–ª–æ—Å—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É:
- –î–Ω–µ–≤–Ω—ã–º–∏ YTM (YIELDCLOSE —Å MOEX)
- –°–≤–µ—á–Ω—ã–º–∏ YTM (—Ä–∞—Å—á—ë—Ç –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π)

### –ü—Ä–∏—á–∏–Ω–∞

–ò—Å—Ç–æ—Ä–∏—è –∏ —Å–≤–µ—á–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –∑–∞ **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥** (365 –¥–Ω–µ–π):
- –ò—Å—Ç–æ—Ä–∏—è: –¥–Ω–µ–≤–Ω—ã–µ YTM –∑–∞ 365 –¥–Ω–µ–π
- –°–≤–µ—á–∏: —á–∞—Å–æ–≤—ã–µ YTM –∑–∞ 365 –¥–Ω–µ–π (~2500 —Ç–æ—á–µ–∫!)

### –†–µ—à–µ–Ω–∏–µ

1. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å intraday –¥–∞–Ω–Ω—ã–µ –¥–æ 30 –¥–Ω–µ–π
2. –û–±—Ä–µ–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–æ –Ω–∞—á–∞–ª–∞ —Å–≤–µ—á–µ–π (–Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å)
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ vs —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### Git

- –ö–æ–º–º–∏—Ç: `a17629f`
- Push: https://github.com/mishasya-dev/ofz-spread-analytics

---

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è v0.3.0 (28.02.2026)

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (198 —Ç–µ—Å—Ç–æ–≤)

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å |
|------|--------|--------|
| test_database.py | ~100 | ‚úÖ –ü—Ä–æ—à–ª–∏ |
| test_sidebar_v030.py | 36 | ‚úÖ –ü—Ä–æ—à–ª–∏ |
| test_charts_v030.py | 28 | ‚úÖ –ü—Ä–æ—à–ª–∏ |
| test_models_bond.py | 26 | ‚úÖ –ü—Ä–æ—à–ª–∏ |
| test_sidebar.py | 14 | ‚úÖ –ü—Ä–æ—à–ª–∏ |
| test_ytm_calculation.py | 6 | ‚úÖ –ü—Ä–æ—à–ª–∏ |
| test_ui.py | 12 | ‚ùå Playwright (–Ω—É–∂–Ω—ã –±—Ä–∞—É–∑–µ—Ä—ã) |

---

### ‚úÖ –£–∂–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

#### 1. Sidebar (test_sidebar_v030.py)
- `render_period_selector()` ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω 30-730, —à–∞–≥ 30, —Ñ–æ—Ä–º–∞—Ç
- `render_candle_interval_selector()` ‚Äî –æ–ø—Ü–∏–∏ 1/10/60, format_func
- `render_auto_refresh()` ‚Äî toggle, –∏–Ω—Ç–µ—Ä–≤–∞–ª, session_state
- `render_db_panel()` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∫–Ω–æ–ø–∫–∞, callback, –æ—à–∏–±–∫–∏
- `render_bond_selection()` ‚Äî selectbox, format_func, YTM –≤ –º–µ—Ç–∫–µ
- `format_bond_label()` ‚Äî YTM, –¥—é—Ä–∞—Ü–∏—è, –≥–æ–¥—ã –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è
- `get_years_to_maturity()` ‚Äî –±—É–¥—É—â–∏–µ/–ø—Ä–æ—à–ª—ã–µ –¥–∞—Ç—ã
- `get_bonds_list()` ‚Äî —Å–ø–∏—Å–æ–∫ –∏–∑ session_state

#### 2. Charts (test_charts_v030.py)
- `calculate_future_range()` ‚Äî –ø—É—Å—Ç–æ–π –∏–Ω–¥–µ–∫—Å, –æ–¥–Ω–∞ —Ç–æ—á–∫–∞, 15% –∑–∞–ø–∞—Å
- `create_daily_ytm_chart()` ‚Äî –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, 1/2 –æ–±–ª–∏–≥–∞—Ü–∏–∏, —Ü–≤–µ—Ç–∞
- `create_daily_spread_chart()` ‚Äî –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ P25/P75, fill, —Ü–≤–µ—Ç
- `create_combined_ytm_chart()` ‚Äî –∏—Å—Ç–æ—Ä–∏—è + —Å–≤–µ—á–∏, 4 –ª–∏–Ω–∏–∏
- `create_intraday_spread_chart()` ‚Äî —Ä–µ—Ñ–µ—Ä–µ–Ω—Å –æ—Ç –¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `apply_zoom_range()` ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

#### 3. Models (test_models_bond.py)
- Bond dataclass ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ, defaults
- `Bond.from_dict()` / `from_db_row()` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- `Bond.to_dict()` / `to_db_dict()` ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `get_years_to_maturity()` ‚Äî —Ä–∞—Å—á—ë—Ç –ª–µ—Ç
- `format_label()` ‚Äî –º–µ—Ç–∫–∞ —Å YTM/–¥—é—Ä–∞—Ü–∏–µ–π
- BondPair ‚Äî —Ä–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–∞

---

### ‚ùå –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

#### üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

##### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã app.py

**–§—É–Ω–∫—Ü–∏—è: `calculate_spread_stats()`**
```python
# –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –ü—É—Å—Ç–æ–π series ‚Üí –ø—É—Å—Ç–æ–π dict
- Series —Å NaN ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –í—Å–µ –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏: p10, p25, p50, p75, p90
- mean, median, std, min, max
- current = –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
```

**–§—É–Ω–∫—Ü–∏—è: `generate_signal()`**
```python
# –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- spread < p25 ‚Üí SELL_BUY
- spread < p10 ‚Üí STRONG
- spread > p75 ‚Üí BUY_SELL
- spread > p90 ‚Üí STRONG
- p25 <= spread <= p75 ‚Üí NEUTRAL
- –ü—Ä–æ–≤–µ—Ä–∫–∞ reason, color, strength
```

**–§—É–Ω–∫—Ü–∏—è: `prepare_spread_dataframe()`**
```python
# –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –ü—É—Å—Ç–æ–π df1 –∏–ª–∏ df2 ‚Üí –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–∫–∏ ytm ‚Üí –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á—ë—Ç: spread = (ytm1 - ytm2) * 100
- –£–¥–∞–ª–µ–Ω–∏–µ NaN
- is_intraday=True ‚Üí –∫–æ–ª–æ–Ω–∫–∞ 'datetime'
- is_intraday=False ‚Üí –∫–æ–ª–æ–Ω–∫–∞ 'date'
```

##### 2. Linked Zoom —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

```python
# test_linked_zoom.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

def test_zoom_selection_captured():
    """–í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ session_state"""

def test_zoom_applied_to_paired_chart():
    """Zoom —Å –≥—Ä–∞—Ñ–∏–∫–∞ 1 –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –≥—Ä–∞—Ñ–∏–∫—É 2"""

def test_zoom_reset_clears_session_state():
    """–ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –æ—á–∏—â–∞–µ—Ç zoom range"""

def test_intraday_zoom_separate_from_daily():
    """Zoom –≥—Ä–∞—Ñ–∏–∫–æ–≤ 3-4 –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç 1-2"""
```

##### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
# test_edge_cases.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

def test_empty_daily_data():
    """–ü—É—Å—Ç—ã–µ –¥–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"""

def test_empty_intraday_data():
    """–ü—É—Å—Ç—ã–µ intraday –¥–∞–Ω–Ω—ã–µ ‚Üí —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏—è"""

def test_nan_in_spread():
    """NaN –≤ YTM ‚Üí –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ —Å–ø—Ä–µ–¥–∞"""

def test_single_day_data():
    """–û–¥–Ω–∞ —Ç–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ"""

def test_moex_api_timeout():
    """–¢–∞–π–º–∞—É—Ç MOEX ‚Üí graceful degradation"""
```

---

#### üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

##### 4. –§—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î

**–§—É–Ω–∫—Ü–∏—è: `update_database_full()`**
```python
# –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –ü—Ä–æ–≥—Ä–µ—Å—Å callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –î–Ω–µ–≤–Ω—ã–µ YTM —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- Intraday YTM –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π
- –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ {daily_ytm_saved, intraday_ytm_saved, errors}
```

##### 5. Session State –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```python
# test_session_init.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

def test_init_session_state_defaults():
    """–í—Å–µ defaults —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"""

def test_session_state_persistence():
    """–ó–Ω–∞—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É rerun"""

def test_bonds_migration_from_config():
    """–ú–∏–≥—Ä–∞—Ü–∏—è –æ–±–ª–∏–≥–∞—Ü–∏–π –∏–∑ config.py"""

def test_bonds_loaded_from_db():
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π –∏–∑ –ë–î"""
```

##### 6. Candle Interval Constraints

```python
# test_candle_constraints.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

def test_1min_max_3_days():
    """1-–º–∏–Ω—É—Ç–Ω—ã–µ —Å–≤–µ—á–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã 3 –¥–Ω—è–º–∏"""

def test_10min_max_30_days():
    """10-–º–∏–Ω—É—Ç–Ω—ã–µ —Å–≤–µ—á–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã 30 –¥–Ω—è–º–∏"""

def test_60min_max_365_days():
    """–ß–∞—Å–æ–≤—ã–µ —Å–≤–µ—á–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã 365 –¥–Ω—è–º–∏"""

def test_period_capped_by_interval():
    """–ü–µ—Ä–∏–æ–¥ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É"""
```

---

#### üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

##### 7. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

```python
# test_formatting.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

def test_bond_label_without_ytm():
    """–ú–µ—Ç–∫–∞ –±–µ–∑ YTM ‚Äî —Ç–æ–ª—å–∫–æ –∏–º—è –∏ –≥–æ–¥—ã"""

def test_bond_label_with_all_data():
    """–ú–µ—Ç–∫–∞ —Å YTM, –¥—é—Ä–∞—Ü–∏–µ–π, –≥–æ–¥–∞–º–∏"""

def test_metric_display_format():
    """–§–æ—Ä–º–∞—Ç –º–µ—Ç—Ä–∏–∫: YTM.2f%, spread.1f –±.–ø."""

def test_exchange_status_open():
    """–°—Ç–∞—Ç—É—Å –±–∏—Ä–∂–∏: –æ—Ç–∫—Ä—ã—Ç–∞"""

def test_exchange_status_closed():
    """–°—Ç–∞—Ç—É—Å –±–∏—Ä–∂–∏: –∑–∞–∫—Ä—ã—Ç–∞"""
```

##### 8. –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤

```python
# test_chart_colors.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

def test_bond1_history_color():
    """–û–±–ª–∏–≥–∞—Ü–∏—è 1 –∏—Å—Ç–æ—Ä–∏—è: #1a5276"""

def test_bond1_intraday_color():
    """–û–±–ª–∏–≥–∞—Ü–∏—è 1 —Å–≤–µ—á–∏: #3498DB"""

def test_bond2_history_color():
    """–û–±–ª–∏–≥–∞—Ü–∏—è 2 –∏—Å—Ç–æ—Ä–∏—è: #922B21"""

def test_bond2_intraday_color():
    """–û–±–ª–∏–≥–∞—Ü–∏—è 2 —Å–≤–µ—á–∏: #E74C3C"""

def test_spread_color():
    """–°–ø—Ä–µ–¥: #9B59B6"""
```

---

### üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –º–æ–¥—É–ª—è–º

| –ú–æ–¥—É–ª—å | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ |
|--------|---------|---------|
| app.py | 0% | 70% |
| components/sidebar.py | 90% | 95% |
| components/charts.py | 80% | 90% |
| core/database.py | 85% | 90% |
| api/moex_*.py | 70% | 80% |
| models/bond.py | 95% | 95% |

---

### üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (2-3 —á–∞—Å–∞)**
1. `test_app_integration.py` ‚Äî calculate_spread_stats, generate_signal
2. `test_spread_preparation.py` ‚Äî prepare_spread_dataframe
3. `test_edge_cases.py` ‚Äî –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, NaN

**–§–∞–∑–∞ 2: –°–≤—è–∑–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ (1-2 —á–∞—Å–∞)**
4. `test_linked_zoom.py` ‚Äî zoom —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
5. `test_candle_constraints.py` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤

**–§–∞–∑–∞ 3: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (1-2 —á–∞—Å–∞)**
6. `test_session_init.py` ‚Äî session_state
7. `test_update_db.py` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
8. `test_formatting.py` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –¢–µ—Å—Ç–æ–≤ | –í—Ä–µ–º—è |
|-----------|--------|-------|
| üî¥ –í—ã—Å–æ–∫–∏–π | ~30 | 3-4 —á–∞—Å–∞ |
| üü° –°—Ä–µ–¥–Ω–∏–π | ~20 | 2-3 —á–∞—Å–∞ |
| üü¢ –ù–∏–∑–∫–∏–π | ~15 | 1-2 —á–∞—Å–∞ |
| **–ò—Ç–æ–≥–æ** | **~65** | **6-9 —á–∞—Å–æ–≤** |

---

*–ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω: 28.02.2026*

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã v0.3.0 (28.02.2026)

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç |
|------|--------|---------------|
| `test_app_integration.py` | 30 | calculate_spread_stats, generate_signal, prepare_spread_dataframe |
| `test_edge_cases.py` | 25 | –ü—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, NaN, –æ–¥–Ω–∞ —Ç–æ—á–∫–∞, –≥—Ä–∞–Ω–∏—Ü—ã |
| `test_linked_zoom.py` | 22 | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è zoom, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø–∞—Ä |

### –î–µ—Ç–∞–ª–∏ test_app_integration.py

**TestCalculateSpreadStats (8 —Ç–µ—Å—Ç–æ–≤):**
- –ü—É—Å—Ç–æ–π series ‚Üí –ø—É—Å—Ç–æ–π dict
- –û–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –≤—Å–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∞–≤–Ω—ã
- –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ p10, p25, p75, p90
- NaN –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á—ë—Ç–∞
- –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- current = –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –ë–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (10,000 –∑–Ω–∞—á–µ–Ω–∏–π)

**TestGenerateSignal (12 —Ç–µ—Å—Ç–æ–≤):**
- spread < p25 ‚Üí SELL_BUY
- spread < p10 ‚Üí –°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
- spread > p75 ‚Üí BUY_SELL
- spread > p90 ‚Üí –°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
- p25 <= spread <= p75 ‚Üí NEUTRAL
- –ì—Ä–∞–Ω–∏—Ü—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ NEUTRAL
- –ü—Ä–æ–≤–µ—Ä–∫–∞ reason, color, strength

**TestPrepareSpreadDataframe (10 —Ç–µ—Å—Ç–æ–≤):**
- –ü—É—Å—Ç–æ–π df1/df2 ‚Üí –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–∫–∏ ytm ‚Üí –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- spread = (ytm1 - ytm2) * 100
- –£–¥–∞–ª–µ–Ω–∏–µ NaN —Å—Ç—Ä–æ–∫
- daily ‚Üí –∫–æ–ª–æ–Ω–∫–∞ 'date'
- intraday ‚Üí –∫–æ–ª–æ–Ω–∫–∞ 'datetime'
- –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥
- –†–∞–∑–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã ‚Äî –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ

### –î–µ—Ç–∞–ª–∏ test_edge_cases.py

**TestEmptyDailyData (5 —Ç–µ—Å—Ç–æ–≤):**
- –ü—É—Å—Ç–æ–π DataFrame YTM
- –ü—É—Å—Ç–æ–π series —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ì—Ä–∞—Ñ–∏–∫–∏ —Å –ø—É—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**TestEmptyIntradayData (3 —Ç–µ—Å—Ç–∞):**
- –ü—É—Å—Ç–æ–π DataFrame —Å–≤–µ—á–µ–π
- –°–∫–ª–µ–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å —Ç–æ–ª—å–∫–æ –¥–Ω–µ–≤–Ω—ã–º–∏

**TestNaNHandling (4 —Ç–µ—Å—Ç–∞):**
- NaN –≤ YTM series
- NaN –≤ —Ä–∞—Å—á—ë—Ç–µ —Å–ø—Ä–µ–¥–∞
- –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏ —Å NaN
- –ü–æ–ª–Ω–æ—Å—Ç—å—é NaN series

**TestSingleDataPoint (4 —Ç–µ—Å—Ç–∞):**
- –û–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ YTM
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏
- –ì—Ä–∞—Ñ–∏–∫ —Å –æ–¥–Ω–æ–π —Ç–æ—á–∫–æ–π
- –°–ø—Ä–µ–¥ –∏–∑ –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏

**TestDateRangeBoundaries (5 —Ç–µ—Å—Ç–æ–≤):**
- –ü–µ—Ä–∏–æ–¥ min=30, max=730 –¥–Ω–µ–π
- 1–º–∏–Ω = max 3 –¥–Ω—è
- 10–º–∏–Ω = max 30 –¥–Ω–µ–π
- 60–º–∏–Ω = max 365 –¥–Ω–µ–π

**TestPercentileBoundaries (2 —Ç–µ—Å—Ç–∞):**
- –ü–æ—Ä—è–¥–æ–∫ p10 < p25 < p50 < p75 < p90
- –ü–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ

### –î–µ—Ç–∞–ª–∏ test_linked_zoom.py

**TestZoomRangeStorage (4 —Ç–µ—Å—Ç–∞):**
- daily_zoom_range = None –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- intraday_zoom_range = None –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Å–±—Ä–æ—Å zoom

**TestApplyZoomRange (4 —Ç–µ—Å—Ç–∞):**
- –í–∞–ª–∏–¥–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
- None –¥–∏–∞–ø–∞–∑–æ–Ω ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ß–∞—Å—Ç–∏—á–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (–æ–¥–∏–Ω None) –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
- –°—Ç—Ä–æ–∫–æ–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –æ—Ç Plotly

**TestDailyChartsSync (3 —Ç–µ—Å—Ç–∞):**
- –û–±–∞ –≥—Ä–∞—Ñ–∏–∫–∞ 1-2 –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω range
- Zoom –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ YTM
- Zoom –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Å–ø—Ä–µ–¥—É

**TestIntradayChartsSync (2 —Ç–µ—Å—Ç–∞):**
- –°–∫–ª–µ–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç range
- Intraday —Å–ø—Ä–µ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç range

**TestZoomIndependence (3 —Ç–µ—Å—Ç–∞):**
- Daily –∏ intraday zoom –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ intraday –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ daily
- –°–±—Ä–æ—Å daily –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ intraday

### –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
–î–æ:    198 —Ç–µ—Å—Ç–æ–≤
–ü–æ—Å–ª–µ: 287 —Ç–µ—Å—Ç–æ–≤ (+89)
–ü—Ä–æ—à–ª–∏: 275 ‚úÖ
–û—à–∏–±–∫–∏: 12 (Playwright UI - –Ω—É–∂–Ω—ã –±—Ä–∞—É–∑–µ—Ä—ã)
```

---

*–¢–µ—Å—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã: 28.02.2026*

---

*–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: 28.02.2026*
