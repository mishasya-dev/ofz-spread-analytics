# Changelog

All notable changes to this project will be documented in this file.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

## [0.2.0] - В РАЗРАБОТКЕ

### Планируется

#### Динамическое управление облигациями
- Таблица `bonds` в SQLite для хранения облигаций
- Загрузка всех ОФЗ с MOEX API
- Автоматическая фильтрация:
  - Только ОФЗ-ПД (постоянный купон, 26xxx, 25xxx)
  - Срок до погашения > 1 года
  - Торги за последние 10 дней
- Поле `is_favorite` для пользовательского выбора
- Модальное окно (`@st.dialog`) для управления списком
- Дюрация из MOEX (обязательное поле)

#### Архитектура
- Уровни: Все ОФЗ (300+) → Отфильтрованные (30-40) → Избранные → Активные (2)
- Migration: полный переход на SQLite, отказ от hardcoded config.py
- Погашенные/не торгующиеся облигации не сохраняются в БД

---

## [0.1.0] - 2026-02-26

### Added

#### База данных SQLite
- Таблица `daily_ytm` — дневные YTM с MOEX (без расчёта)
- Таблица `intraday_ytm` — рассчитанные YTM из цен свечей
- Таблица `spreads` — спреды между облигациями с сигналами
- Кнопка **"Обновить БД"** с прогресс-баром
- Статистика БД в sidebar (количество записей, последние даты)

#### Режимы работы
- **Данные биржи (daily)** — YTM из YIELDCLOSE MOEX
- **Внутридневной (intraday)** — YTM рассчитывается из цен свечей

#### Интервалы свечей
- 1 минута (макс 3 дня)
- 10 минут (макс 7 дней)
- 1 час (макс 30 дней)

#### Расчёт YTM
- Метод Ньютона-Рафсона для расчёта YTM из цены
- Fallback на метод бисекции
- Учёт НКД (накопленный купонный доход)

#### Тестирование
- 38 основных тестов (`tests/run_tests.py`)
- 38 тестов БД (`tests/test_database.py`)
- Итого: **76 тестов**

### Changed

- Оптимизация загрузки данных: только новые данные с MOEX
- Исторические данные загружаются из SQLite
- Переименовано "Дневные данные" → "Данные биржи (day close YTM)"

### Fixed

- Исправлены ISIN коды облигаций
- Исправлен URL API (убран `/boards/{board}/`)
- Исправлено поле YTM: `YIELDCLOSE` вместо `YIELDCOUPON`
- Убраны неподдерживаемые интервалы (30 мин, 4 часа)

---

## История коммитов

| Дата | Коммит | Описание |
|------|--------|----------|
| 26.02.26 | `d8dba03` | SQLite для YTM и спредов + кнопка "Обновить БД" |
| 26.02.26 | `631fd97` | SQLite для хранения свечей |
| 26.02.26 | `27fde1c` | Intraday хранилище данных |
| 26.02.26 | `efd0c9f` | Комплексные тесты (38 тестов) |
| 26.02.26 | `eccef31` | Переименование режима |
| 26.02.26 | `bbf365f` | Динамические лимиты истории |
| 26.02.26 | `bc501f7` | Исправление интервалов свечей |
| 26.02.26 | `9582f6f` | Intraday режим с расчётом YTM |
| 26.02.26 | `3047a58` | Расчёт YTM из цены свечей |
| 26.02.26 | `1e6849b` | Базовая версия: 16 ОФЗ, MOEX API, графики, сигналы |

---

## Roadmap

### Планируется

- [ ] Экспорт сигналов (Telegram, Email)
- [ ] Бэктестинг стратегий
- [ ] Исторические сигналы с PnL
- [ ] График PnL портфеля
- [ ] Алерты при достижении порогов спреда
- [ ] REST API для внешних систем

---

## Ссылки

- **Репозиторий:** https://github.com/mishasya-dev/ofz-spread-analytics
- **MOEX API:** https://iss.moex.com/iss/reference/
