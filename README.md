# OFZ Spread Analytics

–ê–Ω–∞–ª–∏–∑ —Å–ø—Ä–µ–¥–æ–≤ –æ–±–ª–∏–≥–∞—Ü–∏–π –û–§–ó —Å –¥–∞–Ω–Ω—ã–º–∏ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏ (MOEX).

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** 0.2.2

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

| –†–µ–∂–∏–º | –ò—Å—Ç–æ—á–Ω–∏–∫ YTM | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------------|----------|
| üìÖ **–î–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏** | MOEX YIELDCLOSE | –î–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–æ—Ä–≥–æ–≤ |
| ‚è±Ô∏è **–í–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω–æ–π** | –†–∞—Å—á—ë—Ç –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π | 1 –º–∏–Ω, 10 –º–∏–Ω, 1 —á–∞—Å |

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏—è–º–∏** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Å MOEX API
- üìà **–ì—Ä–∞—Ñ–∏–∫–∏ YTM** (Plotly) –¥–ª—è –¥–≤—É—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π
- üìâ **–ê–Ω–∞–ª–∏–∑ —Å–ø—Ä–µ–¥–æ–≤** —Å –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è–º–∏ (P10, P25, P75, P90)
- üéØ **–¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã** (SELL_BUY / BUY_SELL / NEUTRAL)
- üîÑ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª)
- üóÑÔ∏è **SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
- ‚ö° **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π MOEX API** ‚Äî ~2 —Å–µ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### Intraday —Ä–µ–∂–∏–º

| –ò–Ω—Ç–µ—Ä–≤–∞–ª | –ú–∞–∫—Å –ø–µ—Ä–∏–æ–¥ | –°–≤–µ—á–µ–π |
|----------|-------------|--------|
| 1 –º–∏–Ω—É—Ç–∞ | 3 –¥–Ω—è | ~1200 |
| 10 –º–∏–Ω—É—Ç | 30 –¥–Ω–µ–π | ~400 |
| **1 —á–∞—Å** | **365 –¥–Ω–µ–π** | ~4000 |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
streamlit-app/
‚îú‚îÄ‚îÄ app.py                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª Streamlit
‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (16 –û–§–ó –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
‚îú‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ start.bat                 # –ó–∞–ø—É—Å–∫ –¥–ª—è Windows
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ moex_bonds.py         # –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–∏–≥–∞—Ü–∏–π —Å MOEX
‚îÇ   ‚îú‚îÄ‚îÄ moex_history.py       # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (YIELDCLOSE)
‚îÇ   ‚îú‚îÄ‚îÄ moex_trading.py       # –¢–æ—Ä–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (live)
‚îÇ   ‚îî‚îÄ‚îÄ moex_candles.py       # –í–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏ + —Ä–∞—Å—á—ë—Ç YTM
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ database.py           # SQLite –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ ytm_calculator.py     # –†–∞—Å—á—ë—Ç YTM –º–µ—Ç–æ–¥–æ–º –ù—å—é—Ç–æ–Ω–∞-–†–∞—Ñ—Å–æ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ spread.py             # –†–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ signals.py            # –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ charts.py             # –ì—Ä–∞—Ñ–∏–∫–∏ Plotly
‚îÇ   ‚îî‚îÄ‚îÄ bond_manager.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏—è–º–∏ (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ)
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ run_tests.py          # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ test_database.py      # –¢–µ—Å—Ç—ã –ë–î
    ‚îú‚îÄ‚îÄ test_moex_bonds.py    # –¢–µ—Å—Ç—ã MOEX API
    ‚îî‚îÄ‚îÄ test_sidebar.py       # –¢–µ—Å—Ç—ã sidebar
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### MOEX API (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è |
|----------|-------|
| –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –û–§–ó | ~1.7 —Å–µ–∫ |
| –ü–∞–∫–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | ~1.0 —Å–µ–∫ |
| Intraday (2 –æ–±–ª–∏–≥–∞—Ü–∏–∏) | ~1.2 —Å–µ–∫ |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- **–ü–∞–∫–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Äî –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ü–∞–≥–∏–Ω–∞—Ü–∏—è** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ SQLite** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–°–ø—Ä–µ–¥—ã –Ω–∞ –ª–µ—Ç—É** ‚Äî —Ä–∞—Å—á—ë—Ç –∏–∑ YTM –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install -r requirements.txt
```

## –ó–∞–ø—É—Å–∫

```bash
# Linux/macOS
streamlit run app.py

# Windows
start.bat
```

## –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã

| –°–∏–≥–Ω–∞–ª | –£—Å–ª–æ–≤–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|---------|----------|
| SELL_BUY | –°–ø—Ä–µ–¥ < P25 | –ü—Ä–æ–¥–∞—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 1, –ö—É–ø–∏—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 2 |
| BUY_SELL | –°–ø—Ä–µ–¥ > P75 | –ö—É–ø–∏—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 1, –ü—Ä–æ–¥–∞—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 2 |
| NEUTRAL | P25 ‚â§ –°–ø—Ä–µ–¥ ‚â§ P75 | –£–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ |

**–°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞:**
- **–°–∏–ª—å–Ω—ã–π** ‚Äî —Å–ø—Ä–µ–¥ < P10 –∏–ª–∏ > P90
- **–°—Ä–µ–¥–Ω–∏–π** ‚Äî —Å–ø—Ä–µ–¥ < P25 –∏–ª–∏ > P75

## –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏—è–º–∏

### –£—Ä–æ–≤–Ω–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

```
–í—Å–µ –û–§–ó (300+) ‚Üí –¢–æ—Ä–≥—É—é—â–∏–µ—Å—è (30-40) ‚Üí –ò–∑–±—Ä–∞–Ω–Ω—ã–µ ‚Üí –ê–∫—Ç–∏–≤–Ω—ã–µ (2)
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

- –û–§–ó-–ü–î (26xxx, 25xxx, 24xxx)
- –°—Ä–æ–∫ –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è > 0.5 –≥–æ–¥–∞
- –ï—Å—Ç—å —Å–¥–µ–ª–∫–∏ (num_trades > 0)
- –ï—Å—Ç—å –¥—é—Ä–∞—Ü–∏—è

### –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ

–ö–Ω–æ–ø–∫–∞ **"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏—è–º–∏"** –≤ sidebar –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –û–§–ó —Å MOEX
- –î–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ (‚≠ê)
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥—é—Ä–∞—Ü–∏–∏, YTM, –∫—É–ø–æ–Ω—É

## –†–∞—Å—á—ë—Ç YTM –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π

**–ú–µ—Ç–æ–¥:** –ù—å—é—Ç–æ–Ω–∞-–†–∞—Ñ—Å–æ–Ω–∞ —Å fallback –Ω–∞ –±–∏—Å–µ–∫—Ü–∏—é

**–£—á–∏—Ç—ã–≤–∞–µ—Ç:**
- –ù–æ–º–∏–Ω–∞–ª (1000 —Ä—É–±.)
- –ö—É–ø–æ–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞
- –ß–∞—Å—Ç–æ—Ç–∞ –∫—É–ø–æ–Ω–æ–≤ (2 —Ä–∞–∑–∞ –≤ –≥–æ–¥)
- –î–∞—Ç–∞ –ø–æ–≥–∞—à–µ–Ω–∏—è
- –ù–ö–î (–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –∫—É–ø–æ–Ω–Ω—ã–π –¥–æ—Ö–æ–¥)

**–¢–æ—á–Ω–æ—Å—Ç—å:** ~5 –±.–ø. vs —Ä—ã–Ω–æ—á–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å MOEX

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–¥—É–ª—å
pytest tests/test_ytm_calculation.py -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest tests/ -v --cov=. --cov-report=html
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 97 —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ + 12 UI-—Ç–µ—Å—Ç–æ–≤, –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Git Flow

```
main (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑)
  ‚îî‚îÄ‚îÄ develop (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
        ‚îú‚îÄ‚îÄ feature/xxx  ‚Äî –Ω–æ–≤—ã–µ —Ñ–∏—á–∏
        ‚îú‚îÄ‚îÄ fix/xxx      ‚Äî –±–∞–≥—Ñ–∏–∫—Å—ã
        ‚îî‚îÄ‚îÄ refactor/xxx ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pip install -r requirements.txt
pip install pytest pytest-cov pre-commit black isort flake8 commitizen

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit hooks
pre-commit install
pre-commit install --hook-type commit-msg
```

### –ö–æ–º–º–∏—Ç—ã (Conventional Commits)

```bash
feat(ui): add bond manager modal
fix(ytm): correct settlement date calculation
refactor(db): split into repositories
test(api): add moex_bonds tests
docs: update README
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
black . --line-length=100
isort . --profile=black --line-length=100

# –õ–∏–Ω—Ç–µ—Ä
flake8 . --max-line-length=100 --ignore=E501,W503,E203

# Pre-commit (–≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
pre-commit run --all-files
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [CONTRIBUTING.md](CONTRIBUTING.md)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- Streamlit
- Pandas, NumPy
- Plotly
- Requests

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
