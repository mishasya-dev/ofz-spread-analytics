# OFZ Spread Analytics

–ê–Ω–∞–ª–∏–∑ —Å–ø—Ä–µ–¥–æ–≤ –æ–±–ª–∏–≥–∞—Ü–∏–π –û–§–ó —Å –¥–∞–Ω–Ω—ã–º–∏ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏ (MOEX).

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** 0.1.0  
**–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:** 0.2.0 ‚Äî –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏—è–º–∏

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

| –†–µ–∂–∏–º | –ò—Å—Ç–æ—á–Ω–∏–∫ YTM | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------------|----------|
| üìÖ **–î–∞–Ω–Ω—ã–µ –±–∏—Ä–∂–∏** | MOEX YIELDCLOSE | –î–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–æ—Ä–≥–æ–≤ |
| ‚è±Ô∏è **–í–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω–æ–π** | –†–∞—Å—á—ë—Ç –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π | 1 –º–∏–Ω, 10 –º–∏–Ω, 1 —á–∞—Å |

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä **16 –û–§–ó –æ–±–ª–∏–≥–∞—Ü–∏–π** —Å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ ISIN –∫–æ–¥–∞–º–∏
- üìà **–ì—Ä–∞—Ñ–∏–∫–∏ YTM** (Plotly) –¥–ª—è –¥–≤—É—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π
- üìâ **–ê–Ω–∞–ª–∏–∑ —Å–ø—Ä–µ–¥–æ–≤** —Å –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è–º–∏ (P10, P25, P75, P90)
- üéØ **–¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã** (SELL_BUY / BUY_SELL / NEUTRAL)
- üîÑ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª)
- üóÑÔ∏è **SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
- üíæ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å MOEX

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
streamlit-app/
‚îú‚îÄ‚îÄ app.py                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª Streamlit
‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–ª–∏–≥–∞—Ü–∏–π (16 –û–§–ó)
‚îú‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ moex_history.py       # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (YIELDCLOSE)
‚îÇ   ‚îú‚îÄ‚îÄ moex_trading.py       # –¢–æ—Ä–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (live)
‚îÇ   ‚îî‚îÄ‚îÄ moex_candles.py       # –í–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏ + —Ä–∞—Å—á—ë—Ç YTM
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ database.py           # SQLite –ë–î (—Å–≤–µ—á–∏, YTM, —Å–ø—Ä–µ–¥—ã)
‚îÇ   ‚îú‚îÄ‚îÄ data_storage.py       # –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (JSON)
‚îÇ   ‚îú‚îÄ‚îÄ ytm_calculator.py     # –†–∞—Å—á—ë—Ç YTM –º–µ—Ç–æ–¥–æ–º –ù—å—é—Ç–æ–Ω–∞-–†–∞—Ñ—Å–æ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ spread.py             # –†–∞—Å—á—ë—Ç —Å–ø—Ä–µ–¥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ signals.py            # –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ charts.py             # –ì—Ä–∞—Ñ–∏–∫–∏ Plotly
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ run_tests.py          # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (38 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ test_database.py      # –¢–µ—Å—Ç—ã –ë–î (38 —Ç–µ—Å—Ç–æ–≤)
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ ofz_data.db           # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `bonds` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±–ª–∏–≥–∞—Ü–∏—è—Ö |
| `daily_ytm` | –î–Ω–µ–≤–Ω—ã–µ YTM —Å MOEX (YIELDCLOSE) |
| `intraday_ytm` | –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ YTM –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π |
| `spreads` | –°–ø—Ä–µ–¥—ã –º–µ–∂–¥—É –æ–±–ª–∏–≥–∞—Ü–∏—è–º–∏ |
| `candles` | –°—ã—Ä—ã–µ —Å–≤–µ—á–∏ —Å MOEX |
| `snapshots` | –°–Ω–∏–º–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è |

### –ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQLite –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
       ‚Üì
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑ –ë–î
       ‚Üì
3. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å MOEX —Ç–æ–ª—å–∫–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
       ‚Üì
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–µ –≤ –ë–î
       ‚Üì
5. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å: –ë–î + MOEX ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install -r requirements.txt
```

## –ó–∞–ø—É—Å–∫

```bash
streamlit run app.py
```

## –¢–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã

| –°–∏–≥–Ω–∞–ª | –£—Å–ª–æ–≤–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|---------|----------|
| SELL_BUY | –°–ø—Ä–µ–¥ < P25 | –ü—Ä–æ–¥–∞—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 1, –ö—É–ø–∏—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 2 |
| BUY_SELL | –°–ø—Ä–µ–¥ > P75 | –ö—É–ø–∏—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 1, –ü—Ä–æ–¥–∞—Ç—å –û–±–ª–∏–≥–∞—Ü–∏—é 2 |
| NEUTRAL | P25 ‚â§ –°–ø—Ä–µ–¥ ‚â§ P75 | –£–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ |

**–°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞:**
- **–°–∏–ª—å–Ω—ã–π** ‚Äî —Å–ø—Ä–µ–¥ < P10 –∏–ª–∏ > P90
- **–°—Ä–µ–¥–Ω–∏–π** ‚Äî —Å–ø—Ä–µ–¥ < P25 –∏–ª–∏ > P75

## –û–±–ª–∏–≥–∞—Ü–∏–∏ (16 —à—Ç—É–∫)

| ISIN | –ù–∞–∑–≤–∞–Ω–∏–µ | –ö—É–ø–æ–Ω | –ü–æ–≥–∞—à–µ–Ω–∏–µ |
|------|----------|-------|-----------|
| SU26221RMFS0 | –û–§–ó 26221 | 7.70% | 2033-03-23 |
| SU26225RMFS1 | –û–§–ó 26225 | 7.25% | 2034-05-10 |
| SU26230RMFS1 | –û–§–ó 26230 | 7.70% | 2039-03-16 |
| SU26238RMFS4 | –û–§–ó 26238 | 7.10% | 2041-05-15 |
| SU26240RMFS0 | –û–§–ó 26240 | 7.00% | 2036-07-30 |
| SU26241RMFS8 | –û–§–ó 26241 | 9.50% | 2032-11-17 |
| SU26243RMFS4 | –û–§–ó 26243 | 9.80% | 2038-05-19 |
| SU26244RMFS2 | –û–§–ó 26244 | 11.25% | 2034-03-15 |
| SU26245RMFS9 | –û–§–ó 26245 | 12.00% | 2035-09-26 |
| SU26246RMFS7 | –û–§–ó 26246 | 12.00% | 2036-03-12 |
| SU26247RMFS5 | –û–§–ó 26247 | 12.25% | 2039-05-11 |
| SU26248RMFS3 | –û–§–ó 26248 | 12.25% | 2040-05-16 |
| SU26250RMFS9 | –û–§–ó 26250 | 12.00% | 2037-06-10 |
| SU26252RMFS5 | –û–§–ó 26252 | 12.50% | 2033-10-12 |
| SU26253RMFS3 | –û–§–ó 26253 | 13.00% | 2038-10-06 |
| SU26254RMFS1 | –û–§–ó 26254 | 13.00% | 2040-10-03 |

## –†–∞—Å—á—ë—Ç YTM –∏–∑ —Ü–µ–Ω —Å–≤–µ—á–µ–π

**–ú–µ—Ç–æ–¥:** –ù—å—é—Ç–æ–Ω–∞-–†–∞—Ñ—Å–æ–Ω–∞ —Å fallback –Ω–∞ –±–∏—Å–µ–∫—Ü–∏—é

**–£—á–∏—Ç—ã–≤–∞–µ—Ç:**
- –ù–æ–º–∏–Ω–∞–ª (1000 —Ä—É–±.)
- –ö—É–ø–æ–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞
- –ß–∞—Å—Ç–æ—Ç–∞ –∫—É–ø–æ–Ω–æ–≤ (2 —Ä–∞–∑–∞ –≤ –≥–æ–¥)
- –î–∞—Ç–∞ –ø–æ–≥–∞—à–µ–Ω–∏—è
- –ù–ö–î (–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –∫—É–ø–æ–Ω–Ω—ã–π –¥–æ—Ö–æ–¥)

**–¢–æ—á–Ω–æ—Å—Ç—å:** ~0.5-1.5 –±.–ø. –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π

## MOEX API

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —Å–≤–µ—á–µ–π

| –ò–Ω—Ç–µ—Ä–≤–∞–ª | –°–≤–µ—á–µ–π –∑–∞ –ø–µ—Ä–∏–æ–¥ |
|----------|------------------|
| 1 –º–∏–Ω—É—Ç–∞ | ~1200 –∑–∞ 3 –¥–Ω—è |
| 10 –º–∏–Ω—É—Ç | ~400 –∑–∞ 7 –¥–Ω–µ–π |
| 1 —á–∞—Å | ~1000 –∑–∞ 90 –¥–Ω–µ–π |

‚ö†Ô∏è **30-–º–∏–Ω—É—Ç–Ω—ã–µ –∏ 4-—á–∞—Å–æ–≤—ã–µ —Å–≤–µ—á–∏ –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è** MOEX API –¥–ª—è –æ–±–ª–∏–≥–∞—Ü–∏–π

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

| –¢–∏–ø | URL |
|-----|-----|
| –¢–æ—Ä–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ | `/engines/stock/markets/bonds/securities/{ISIN}.json` |
| –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ | `/history/engines/stock/markets/bonds/securities/{ISIN}.json` |
| –°–≤–µ—á–∏ | `/engines/stock/markets/bonds/boards/TQOB/securities/{ISIN}/candles.json` |

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã
python3 tests/run_tests.py

# –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python3 tests/test_database.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 76 —Ç–µ—Å—Ç–æ–≤ (38 + 38), –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- Streamlit
- Pandas, NumPy
- Plotly
- Requests

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
